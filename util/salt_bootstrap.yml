---
- hosts: work
  become: yes
  vars_prompt:
    - name: "salt_master"
      prompt: "Enter salt master id"
      private: no
  tasks:
    - shell: curl -L https://bootstrap.saltstack.com -o - | sh -s -- stable creates=/usr/bin/salt-call
    - name: set master id
      lineinfile: "dest=/etc/salt/minion state=present regexp='^#master: salt$' backrefs=yes line='master: {{ salt_master }}'"
      notify: restart salt-minion
    - name: set minion id
      lineinfile: "dest=/etc/salt/minion state=present regexp='^#id:$' backrefs=yes line='id: {{ ansible_hostname }}'"
      notify: restart salt-minion
  handlers:
    - name: restart salt-minion
      service: name=salt-minion state=restarted enabled=yes
